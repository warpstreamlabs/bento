---
title: aws_s3
slug: aws_s3
type: processor
status: experimental
categories: ["Services","AWS"]
---

<!--
     THIS FILE IS AUTOGENERATED!

     To make changes please edit the corresponding source file under internal/impl/<provider>.
-->

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::caution EXPERIMENTAL
This component is experimental and therefore subject to change or removal outside of major version releases.
:::
Performs an S3 GetObject operation using the `bucket` + `key` provided in the config and replaces the original message parts with the content retrieved from S3.

Introduced in version 1.4.0.


<Tabs defaultValue="common" values={[
  { label: 'Common', value: 'common', },
  { label: 'Advanced', value: 'advanced', },
]}>

<TabItem value="common">

```yml
# Common config fields, showing default values
label: ""
aws_s3:
  bucket: "" # No default (required)
  key: "" # No default (required)
  force_path_style_urls: false
  scanner:
    to_the_end: {}
```

</TabItem>
<TabItem value="advanced">

```yml
# All config fields, showing default values
label: ""
aws_s3:
  bucket: "" # No default (required)
  key: "" # No default (required)
  force_path_style_urls: false
  delete_objects: false
  region: ""
  endpoint: ""
  credentials:
    profile: ""
    id: ""
    secret: ""
    token: ""
    from_ec2_role: false
    role: ""
    role_external_id: ""
  scanner:
    to_the_end: {}
```

</TabItem>
</Tabs>

This `aws_s3` processor is offered as an alternative to [streaming-objects-on-upload-with-sqs](/docs/components/inputs/aws_s3#streaming-objects-on-upload-with-sqs).

This `aws_s3` processor may be preferable to the `aws_s3` input with the field `sqs` in the following situations:

- You require data from the SQS message as well the S3 Object Data
- You are using a similar pattern to the [streaming-objects-on-upload-with-sqs](/docs/components/inputs/aws_s3#streaming-objects-on-upload-with-sqs) but with a different queue technology such as RabbitMQ
- You need to access some data from S3 as part of the processing stage of your config

In order to keep the original payload instead of replacing it entirely, you can use the [branch](/docs/components/processors/branch) processor.

## Scanner

Note that this processor is _odd_ because it has a [scanner](/docs/components/scanners/about) field.
This means that depending on the scanner used, it can change the amount of messages.
Therefore if you plan on using it inside a [branch](/docs/components/processors/branch) processor, you would need a scanner that doesn't alter the number of messages, such as the default `to_the_end` scanner.

## Metadata

This input adds the following metadata fields to each message:

```
- s3_key
- s3_bucket
- s3_last_modified_unix
- s3_last_modified (RFC3339)
- s3_content_type
- s3_content_encoding
- s3_content_length
- s3_version_id
- All user defined metadata
```

You can access these metadata fields using [function interpolation](/docs/configuration/interpolation#bloblang-queries). Note that user defined metadata is case insensitive within AWS, and it is likely that the keys will be received in a capitalized form, if you wish to make them consistent you can map all metadata keys to lower or uppercase using a Bloblang mapping such as `meta = meta().map_each_key(key -> key.lowercase())`.

## Examples

<Tabs defaultValue="Amazon SQS Extended Client Library" values={[
{ label: 'Amazon SQS Extended Client Library', value: 'Amazon SQS Extended Client Library', },
{ label: 'Connection to S3 API-Compatable services', value: 'Connection to S3 API-Compatable services', },
]}>

<TabItem value="Amazon SQS Extended Client Library">

This example shows how to create a Bento config that will allow connecting to SQS queues that are using the [Amazon SQS Extended Client Library](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-s3-messages.html)

```yaml
input:
  label: sqs_extended_client

  aws_sqs:
    url: https://sqs.${AWS_REGION}.amazonaws.com/${AWS_ACCOUNT_ID}/sqs-extended-client-queue

  processors:
    - switch: 
        # check it's a large message:
        - check: this.0 == "com.amazon.sqs.javamessaging.MessageS3Pointer" 
        # use the aws_s3 processor to download it 
          processors:
            - aws_s3:
                bucket: ${! this.1.s3BucketName }
                key: ${! this.1.s3Key }
```

</TabItem>
<TabItem value="Connection to S3 API-Compatable services">

This example shows how to connect to "S3 API-Compatable services" - for instance minio.

```yaml
pipeline:
  processors: 
    - aws_s3: 
        bucket: mybucket
        key: events-json-stream/1756305057033860000.json
        endpoint: http://localhost:9000
        force_path_style_urls: true
        region: us-east-1
        credentials:
          id: minioadmin
          secret: minioadmin
```

</TabItem>
</Tabs>

## Fields

### `bucket`

The bucket to perform the GetObject operation on.
This field supports [interpolation functions](/docs/configuration/interpolation#bloblang-queries).


Type: `string`  

### `key`

The key of the object you wish to retrive.
This field supports [interpolation functions](/docs/configuration/interpolation#bloblang-queries).


Type: `string`  

### `force_path_style_urls`

Forces the client API to use path style URLs for downloading keys, which is often required when connecting to custom endpoints.


Type: `bool`  
Default: `false`  

### `delete_objects`

Whether to delete downloaded objects from the bucket once they are processed. Note: the S3 Object will be deleted from AWS as soon as this processor has consumed the object.


Type: `bool`  
Default: `false`  
Requires version 1.5.0 or newer  

### `region`

The AWS region to target.


Type: `string`  
Default: `""`  

### `endpoint`

Allows you to specify a custom endpoint for the AWS API.


Type: `string`  
Default: `""`  

### `credentials`

Optional manual configuration of AWS credentials to use. More information can be found [in this document](/docs/guides/cloud/aws).


Type: `object`  

### `credentials.profile`

A profile from `~/.aws/credentials` to use.


Type: `string`  
Default: `""`  

### `credentials.id`

The ID of credentials to use.


Type: `string`  
Default: `""`  

### `credentials.secret`

The secret for the credentials being used.
:::warning Secret
This field contains sensitive information that usually shouldn't be added to a config directly, read our [secrets page for more info](/docs/configuration/secrets).
:::


Type: `string`  
Default: `""`  

### `credentials.token`

The token for the credentials being used, required when using short term credentials.


Type: `string`  
Default: `""`  

### `credentials.from_ec2_role`

Use the credentials of a host EC2 machine configured to assume [an IAM role associated with the instance](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html).


Type: `bool`  
Default: `false`  
Requires version 1.0.0 or newer  

### `credentials.role`

A role ARN to assume.


Type: `string`  
Default: `""`  

### `credentials.role_external_id`

An external ID to provide when assuming a role.


Type: `string`  
Default: `""`  

### `scanner`

The [scanner](/docs/components/scanners/about) by which the stream of bytes consumed will be broken out into individual messages. Scanners are useful for processing large sources of data without holding the entirety of it within memory. For example, the `csv` scanner allows you to process individual CSV rows without loading the entire CSV file in memory at once.


Type: `scanner`  
Default: `{"to_the_end":{}}`  


